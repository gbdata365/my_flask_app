# 2025년 10월 2일 작업 내역

## 작업 개요
Cloudtype PostgreSQL 연동 및 환경 변수 관리 시스템 구축

---

## 1. 초기 문제 분석

### 문제 상황
- `1_giup/load.py` 실행 시 PostgreSQL 연결 오류 발생
- 오류 메시지: `could not translate host name "postgresql" to address`

### 원인
- 로컬 Windows 환경에서 Cloudtype 내부 호스트명 'postgresql'을 사용하려고 시도
- Cloudtype 내부 네트워크 호스트명은 클라우드 환경 내부에서만 해석 가능

---

## 2. 환경 자동 감지 시스템 구현

### 목표
로컬 개발 환경과 Cloudtype 클라우드 환경을 자동으로 감지하여 적절한 PostgreSQL 연결 설정 사용

### 구현 내용

#### `module/db_config.py` 수정

**환경 감지 함수 추가:**
```python
import socket

def is_cloudtype_environment():
    """Cloudtype 환경인지 확인 (내부 호스트명 'postgresql' 접근 가능 여부)"""
    try:
        socket.gethostbyname('postgresql')
        return True
    except socket.gaierror:
        return False
```

**환경별 설정 함수 수정:**
```python
def get_postgres_config():
    """PostgreSQL 설정 - 환경에 따라 자동 선택"""
    is_cloudtype = is_cloudtype_environment()

    if is_cloudtype:
        # Cloudtype 내부: 내부 호스트명 사용
        return {
            "host": "postgresql",
            "port": 5432,
            "database": os.environ.get("POSTGRES_DB", "postgres"),
            "user": os.environ.get("POSTGRES_USER", "gbdo"),
            "password": os.environ.get("POSTGRES_PASSWORD", "rudqnrehc-jd11"),
        }
    else:
        # 로컬 환경: 외부 접속 정보 사용
        return {
            "host": os.environ.get("POSTGRES_HOST_EXTERNAL", "svc.sel3.cloudtype.app"),
            "port": int(os.environ.get("POSTGRES_PORT_EXTERNAL", "32596")),
            "database": os.environ.get("POSTGRES_DB", "postgres"),
            "user": os.environ.get("POSTGRES_USER", "gbdo"),
            "password": os.environ.get("POSTGRES_PASSWORD", "rudqnrehc-jd11"),
        }
```

---

## 3. .env 파일 구성

### 추가된 환경 변수

```env
# PostgreSQL 설정 (Cloudtype)
# 내부 연결 (Cloudtype 내부에서만 사용)
DATABASE_URL=postgresql://gbdo:rudqnrehc-jd11@postgresql:5432/postgres

# PostgreSQL 개별 항목
POSTGRES_DB=postgres
POSTGRES_USER=gbdo
POSTGRES_PASSWORD=rudqnrehc-jd11

# PostgreSQL 외부 접속 (로컬 개발용) - 새로 추가
POSTGRES_HOST_EXTERNAL=svc.sel3.cloudtype.app
POSTGRES_PORT_EXTERNAL=32596

# Flask 애플리케이션 설정
FLASK_ENV=production
SECRET_KEY=csv_dashboard_secret_key_2024_cloudtype

# 서버 설정
SERVER_HOST=0.0.0.0
SERVER_PORT=5000

# 로그 레벨
LOG_LEVEL=INFO
```

### .gitignore 확인
- `.env` 파일이 이미 `.gitignore`에 포함되어 있어 GitHub에 커밋되지 않음 확인

---

## 4. load.py 파일 이동 및 수정

### 작업 내용
- **이전 위치**: `1_giup/load.py`
- **새 위치**: `1_giup/routes/load.py`

### 목적
기존 동적 라우팅 시스템에 통합하여 웹 인터페이스로 접근 가능하게 함

### 주요 수정 사항

#### 1. 프로젝트 루트 경로 수정
```python
# 변경 전
PROJECT_ROOT = Path(__file__).parent.parent

# 변경 후 (routes 폴더로 이동했으므로)
PROJECT_ROOT = Path(__file__).parent.parent.parent
```

#### 2. Excel 파일 경로 수정
```python
# 변경 후
excel_path = Path(__file__).parent.parent / "data" / "집계표_202312.xlsx"
```

#### 3. render() 함수 추가
```python
def render():
    """동적 라우트 시스템에서 호출되는 메인 함수"""
    from flask import request

    if request and request.method == 'POST':
        return execute_and_show_result()
    else:
        return show_upload_page()
```

#### 4. 웹 인터페이스 추가
```python
def show_upload_page():
    """데이터 업로드 페이지 HTML 반환"""
    return """
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>데이터 업로드</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 50px; }
            .container { max-width: 600px; margin: 0 auto; }
            .btn { background: #007bff; color: white; padding: 15px 30px;
                   border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
            .btn:hover { background: #0056b3; }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>📊 Excel 데이터를 PostgreSQL에 업로드</h1>
            <p>집계표_202312.xlsx 파일의 데이터를 데이터베이스에 업로드합니다.</p>
            <form method="POST">
                <button type="submit" class="btn">업로드 실행</button>
            </form>
        </div>
    </body>
    </html>
    """

def execute_and_show_result():
    """실제 업로드 실행 및 결과 표시"""
    try:
        # 기존 load 함수 실행
        from io import StringIO
        import sys

        old_stdout = sys.stdout
        sys.stdout = StringIO()

        main()  # 기존 main() 함수 실행

        output = sys.stdout.getvalue()
        sys.stdout = old_stdout

        return f"""
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>업로드 결과</title>
        </head>
        <body>
            <h1>✅ 업로드 완료</h1>
            <pre>{output}</pre>
            <a href="/1_giup/routes/load">돌아가기</a>
        </body>
        </html>
        """
    except Exception as e:
        return f"""
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>오류 발생</title>
        </head>
        <body>
            <h1>❌ 오류 발생</h1>
            <pre>{str(e)}</pre>
            <a href="/1_giup/routes/load">돌아가기</a>
        </body>
        </html>
        """
```

### 접속 URL
- `http://localhost:5000/1_giup/routes/load` (로컬)
- `https://your-app.cloudtype.app/1_giup/routes/load` (Cloudtype 배포 후)

---

## 5. main_app.py 인코딩 문제 해결

### 문제
Windows 콘솔에서 이모지(emoji) 출력 시 UnicodeEncodeError 발생

### 해결
```python
if __name__ == "__main__":
    import os
    import sys

    # Windows 콘솔 인코딩 설정
    if sys.platform == 'win32':
        try:
            sys.stdout.reconfigure(encoding='utf-8')
        except:
            pass

    app = create_app()
    print("[INFO] Flask 애플리케이션 시작")
    port = int(os.environ.get('PORT', 5000))
    app.run(debug=False, host='0.0.0.0', port=port)
```

---

## 6. Cloudtype 배포 설정

### Cloudtype 환경 변수 관리 방법

#### 방법 1: 시크릿(Secret) 사용 (권장)

**장점:**
- ✅ GitHub에 민감한 정보를 커밋하지 않음
- ✅ YAML 파일에 비밀번호 노출 안 됨
- ✅ 비밀번호 변경 시 코드 수정 불필요

**설정 방법:**
1. Cloudtype 대시보드 → 서비스 선택 → 설정 탭
2. "시크릿" 섹션에서 환경 변수 추가:

| 키(Key) | 값(Value) |
|---------|-----------|
| DATABASE_URL | postgresql://gbdo:rudqnrehc-jd11@postgresql:5432/postgres |
| POSTGRES_DB | postgres |
| POSTGRES_USER | gbdo |
| POSTGRES_PASSWORD | rudqnrehc-jd11 |
| POSTGRES_HOST_EXTERNAL | svc.sel3.cloudtype.app |
| POSTGRES_PORT_EXTERNAL | 32596 |
| FLASK_ENV | production |
| SECRET_KEY | csv_dashboard_secret_key_2024_cloudtype |
| SERVER_HOST | 0.0.0.0 |
| SERVER_PORT | 5000 |
| LOG_LEVEL | INFO |

#### 방법 2: YAML 파일 사용

**YAML 파일 구조:**

`@gb.data23_myflask_python_main.yaml`:
```yaml
name: my-flask-app11
app: python@3.12
options:
  ports: "5000"
  start: python main_app.py
  healthz: /
  env:
    - name: DATABASE_URL
      value: postgresql://gbdo:rudqnrehc-jd11@postgresql:5432/postgres
    - name: POSTGRES_DB
      value: postgres
    - name: POSTGRES_USER
      value: gbdo
    - name: POSTGRES_PASSWORD
      value: rudqnrehc-jd11
    - name: POSTGRES_HOST_EXTERNAL
      value: svc.sel3.cloudtype.app
    - name: POSTGRES_PORT_EXTERNAL
      value: "32596"
    - name: FLASK_ENV
      value: production
    - name: SECRET_KEY
      value: csv_dashboard_secret_key_2024_cloudtype
    - name: SERVER_HOST
      value: 0.0.0.0
    - name: SERVER_PORT
      value: "5000"
    - name: LOG_LEVEL
      value: INFO
  buildenv: []
resources:
  spot: false
  memory: 0.5
context:
  git:
    url: https://github.com/gbdata365/my_flask_app.git
    branch: main
---
name: postgresql
app: postgresql@16
options:
  rootusername: gbdo
  rootpassword: rudqnrehcjd1!
resources:
  spot: false
  cpu: 0
  memory: 0.5
  disk: 1
  replicas: 1
context:
  preset: postgresql
```

**YAML 설명:**
- `---` 구분자로 Flask 앱과 PostgreSQL 서비스를 하나의 프로젝트로 묶음
- `rootusername`/`rootpassword`: PostgreSQL 관리자 계정
- `env`: Flask 앱의 환경 변수 (일반 사용자 계정 사용 권장)

---

## 7. 여러 서비스 운영 (Flask + Streamlit)

### YAML 구조 예시

```yaml
# Flask 앱
name: my-flask-app11
app: python@3.12
options:
  ports: "5000"
  start: python main_app.py
  env:
    - name: DATABASE_URL
      value: postgresql://gbdo:rudqnrehc-jd11@postgresql:5432/postgres
    - name: FLASK_ENV
      value: production
resources:
  memory: 0.5
context:
  git:
    url: https://github.com/gbdata365/my_flask_app.git
    branch: main
---
# Streamlit 앱
name: my-streamlit-app
app: python@3.12
options:
  ports: "8501"
  start: streamlit run app.py --server.port=8501
  env:
    - name: DATABASE_URL
      value: postgresql://gbdo:rudqnrehc-jd11@postgresql:5432/postgres
    - name: STREAMLIT_SERVER_HEADLESS
      value: "true"
resources:
  memory: 0.5
context:
  git:
    url: https://github.com/gbdata365/my_streamlit_app.git
    branch: main
---
# PostgreSQL
name: postgresql
app: postgresql@16
options:
  rootusername: gbdo
  rootpassword: rudqnrehcjd1!
resources:
  memory: 0.5
  disk: 1
context:
  preset: postgresql
```

**중요:** 각 서비스마다 Cloudtype 대시보드에서 **별도로 시크릿 설정** 필요

---

## 8. PostgreSQL 사용자 계정 관리

### 관리자 계정 vs 일반 사용자 계정

**YAML의 rootusername/rootpassword:**
- PostgreSQL **관리자(superuser) 계정**
- 모든 권한 보유
- 관리 및 DBeaver 접속용으로 사용

**권장 사항:**
1. **관리자 계정으로 PostgreSQL 서비스 생성**
2. **DBeaver로 관리자 계정 접속 후 일반 사용자 생성**
3. **Flask 앱에는 일반 사용자 계정 사용**

### 일반 사용자 생성 방법 (DBeaver)

```sql
-- 1. 새 사용자 생성
CREATE USER appuser WITH PASSWORD 'apppass123!';

-- 2. 데이터베이스 생성 (필요시)
CREATE DATABASE myapp_db;

-- 3. 사용자에게 권한 부여
GRANT ALL PRIVILEGES ON DATABASE myapp_db TO appuser;

-- 4. 스키마 권한 부여 (PostgreSQL 15+)
\c myapp_db
GRANT ALL ON SCHEMA public TO appuser;
GRANT ALL ON ALL TABLES IN SCHEMA public TO appuser;
GRANT ALL ON ALL SEQUENCES IN SCHEMA public TO appuser;
```

### Flask 앱 환경 변수 업데이트

```yaml
env:
  - name: POSTGRES_USER
    value: appuser
  - name: POSTGRES_PASSWORD
    value: apppass123!
  - name: POSTGRES_DB
    value: myapp_db
  - name: DATABASE_URL
    value: postgresql://appuser:apppass123!@postgresql:5432/myapp_db
```

### 보안 이점
- ✅ Flask 앱은 제한된 권한만 가짐
- ✅ 관리자 계정 노출 최소화
- ✅ 데이터베이스별로 사용자 분리 가능

---

## 9. DBeaver 연결 설정

### 연결 정보

**외부 접속 정보 사용 (로컬 개발 환경):**

| 항목 | 값 |
|------|-----|
| **Host** | `svc.sel3.cloudtype.app` |
| **Port** | `32596` |
| **Database** | `postgres` |
| **Username** | `gbdo` |
| **Password** | `rudqnrehcjd1!` |

### 연결 단계

1. DBeaver 실행
2. **Database** → **New Database Connection** → **PostgreSQL** 선택
3. **Main 탭**에서 연결 정보 입력
4. **Test Connection** 클릭
5. 성공하면 **Finish** 클릭

### 발견된 문제

**Connection attempt timed out 오류 발생**

**원인:**
- Cloudtype PostgreSQL 서비스가 외부 접속을 허용하지 않음
- 포트 32596으로 연결 시도 시 타임아웃 발생

**테스트 결과:**
```bash
# 호스트 ping: 성공 (34.64.100.243)
ping svc.sel3.cloudtype.app

# 포트 연결 테스트: 타임아웃
Test-NetConnection -ComputerName svc.sel3.cloudtype.app -Port 32596
```

**해결 방법:**
1. Cloudtype 대시보드 → PostgreSQL 서비스 → 설정
2. "외부 접속" 또는 "Public Access" 옵션 활성화
3. 방화벽 규칙 확인

**대안:**
- Cloudtype 내부에서만 DB 사용 (Flask 앱에서만 접속)
- 로컬 개발용 별도 PostgreSQL 설치
- Cloudtype CLI로 포트 포워딩

---

## 10. 문서화

### 생성된 문서

#### `Cloudtype_배포_가이드.md`

**포함 내용:**
1. 환경 구성 개요
2. 로컬 환경 설정
3. Cloudtype 배포 설정 (시크릿, YAML)
4. DBeaver 연결 설정
5. 트러블슈팅 (5가지 문제와 해결 방법)
6. 배포 체크리스트

**위치:** `C:\Users\user\00_claude_project\project\Cloudtype_배포_가이드.md`

---

## 11. SECRET_KEY 이름 변경

### 변경 이유
- 기존: `csv_dashboard_secret_key_2024_docker`
- Docker를 사용하지 않는데 이름에 "docker"가 포함되어 혼란 발생

### 변경 내용
- 새 이름: `csv_dashboard_secret_key_2024_cloudtype`

### 수정된 파일
1. `.env`
2. `.cloudtype.yaml`
3. `@gb.data23_myflask_python_main.yaml`

### 참고
- SECRET_KEY는 Flask 세션 암호화용 문자열
- 이름에 "docker"가 있어도 Docker 사용 여부와 무관
- 단순히 키 값의 이름일 뿐

---

## 12. 프로젝트 구조

```
project/
├── main_app.py                      # Flask 메인 앱
├── .env                             # 환경 변수 (Git 제외)
├── .gitignore                       # Git 제외 파일 목록
├── requirements.txt                 # Python 패키지 목록
├── .cloudtype.yaml                  # Cloudtype 배포 설정
├── @gb.data23_myflask_python_main.yaml  # Cloudtype YAML (다운로드)
├── Cloudtype_배포_가이드.md          # 배포 가이드 문서
├── cloudtype.yaml                   # Cloudtype 설정 (초기 생성)
├── module/
│   ├── db_config.py                 # DB 연결 설정 (환경 자동 감지)
│   ├── menu_generator.py
│   ├── markdown_renderer.py
│   └── api_routes.py
├── 1_giup/
│   ├── routes/
│   │   └── load.py                  # 데이터 업로드 라우트 (이동됨)
│   ├── data/
│   │   └── 집계표_202312.xlsx
│   ├── html_docs/
│   ├── markdown_docs/
│   └── ...
├── 3_csv_dashboard/
│   └── routes/
│       └── dashboard_routes.py
└── templates/
    ├── index.html
    ├── category_with_navbar.html
    └── ...
```

---

## 13. 동적 라우팅 시스템

### 작동 원리

`main_app.py`의 `execute_route_module()` 함수가 `1_giup/routes/` 폴더의 Python 파일을 자동으로 감지:

```python
@app.route("/1_giup/routes/<filename>", methods=['GET', 'POST'])
def giup_route_exec(filename):
    """routes 폴더의 .py 파일을 동적으로 실행"""
    menu_items = MenuGenerator.get_giup_menu_items(giup_base)
    route_content = execute_route_module(giup_base / "routes", filename)

    if is_complete_html(route_content):
        return MenuGenerator.inject_navbar_to_html(route_content, menu_items, filename)
    else:
        return render_template('category_with_navbar.html',
                             menu_items=menu_items,
                             content=route_content,
                             category_name="1_giup")
```

### 필수 조건
- routes 폴더의 Python 파일은 **반드시 `render()` 함수**를 가져야 함
- 파일명에 언더스코어(`_`)가 없는 파일만 메뉴에 표시

---

## 14. 환경별 연결 정보 정리

### Cloudtype 내부 (배포 환경)

```python
host: postgresql
port: 5432
database: postgres
user: gbdo
password: rudqnrehc-jd11
```

**특징:**
- 내부 DNS 해석으로 'postgresql' 호스트명 사용 가능
- 빠른 내부 네트워크 연결
- 외부에서 접근 불가

### 로컬 개발 환경

```python
host: svc.sel3.cloudtype.app
port: 32596
database: postgres
user: gbdo
password: rudqnrehc-jd11
```

**특징:**
- 외부 엔드포인트 사용
- 외부 접속이 허용되어 있어야 함
- 현재 외부 접속 비활성화 상태로 추정

---

## 15. 트러블슈팅 정리

### 문제 1: 로컬에서 PostgreSQL 연결 실패

**오류:**
```
could not translate host name "postgresql" to address
```

**해결:**
- `module/db_config.py`에 환경 자동 감지 추가
- `.env`에 `POSTGRES_HOST_EXTERNAL`와 `POSTGRES_PORT_EXTERNAL` 추가

---

### 문제 2: render() 함수 없음

**오류:**
```
render() 함수가 없습니다.
```

**해결:**
- `1_giup/routes/load.py`에 `render()` 함수 추가
- 동적 라우팅 시스템의 규칙 준수

---

### 문제 3: Windows 콘솔 인코딩 오류

**오류:**
```
UnicodeEncodeError: 'charmap' codec can't encode character
```

**해결:**
- `main_app.py`에 `sys.stdout.reconfigure(encoding='utf-8')` 추가

---

### 문제 4: DBeaver 연결 타임아웃

**오류:**
```
Connection attempt timed out
```

**원인:**
- Cloudtype PostgreSQL 외부 접속 비활성화

**해결 방법:**
1. Cloudtype 대시보드에서 외부 접속 활성화
2. 또는 Cloudtype CLI 포트 포워딩 사용
3. 또는 로컬 PostgreSQL 설치

---

### 문제 5: .env 파일이 GitHub에 커밋됨

**해결:**
```bash
git rm --cached .env
echo ".env" >> .gitignore
git add .gitignore
git commit -m "Remove .env from git tracking"
git push
```

---

## 16. 배포 체크리스트

### 로컬 개발 환경
- [x] `.env` 파일 생성 및 설정
- [x] `.env`가 `.gitignore`에 포함
- [x] 환경 자동 감지 코드 구현
- [x] 로컬에서 정상 실행 확인

### GitHub
- [x] `.env` 파일이 Git에 포함되지 않음
- [ ] 코드 커밋 및 푸시 (사용자가 직접 수행)
- [ ] `main` 브랜치에 최신 코드 반영

### Cloudtype
- [ ] PostgreSQL 서비스 실행 중
- [ ] Flask 서비스의 시크릿(환경 변수) 설정
- [ ] YAML 파일 업로드 또는 GitHub 자동 배포
- [ ] 서비스 배포 및 실행 상태 확인
- [ ] 로그에서 에러 확인

### 데이터베이스
- [ ] PostgreSQL 외부 접속 활성화 (DBeaver 연결용)
- [ ] DBeaver 연결 테스트
- [ ] 일반 사용자 계정 생성 (선택)
- [ ] 데이터 업로드 테스트

---

## 17. 주요 코드 변경 사항 요약

### module/db_config.py
- `is_cloudtype_environment()` 함수 추가
- `get_postgres_config()` 함수 수정 (환경별 분기)

### .env
- `POSTGRES_HOST_EXTERNAL` 추가
- `POSTGRES_PORT_EXTERNAL` 추가
- `SECRET_KEY` 이름 변경 (docker → cloudtype)

### 1_giup/routes/load.py (이동 및 수정)
- 경로: `1_giup/load.py` → `1_giup/routes/load.py`
- `render()` 함수 추가
- `show_upload_page()` 함수 추가
- `execute_and_show_result()` 함수 추가
- 프로젝트 루트 경로 수정
- Excel 파일 경로 수정

### main_app.py
- Windows 콘솔 UTF-8 인코딩 설정 추가

### 신규 파일
- `.cloudtype.yaml` 생성
- `@gb.data23_myflask_python_main.yaml` (Cloudtype에서 다운로드 후 수정)
- `Cloudtype_배포_가이드.md` 생성
- `cloudtype.yaml` 생성 (초기)

---

## 18. 다음 단계 권장 사항

### 1. Cloudtype PostgreSQL 외부 접속 활성화
- DBeaver 연결을 위해 필수
- Cloudtype 대시보드에서 설정 확인

### 2. 일반 사용자 계정 생성
- 보안 강화를 위해 Flask 앱용 일반 사용자 생성
- 관리자 계정은 관리 및 DBeaver 접속용으로만 사용

### 3. GitHub에 코드 푸시
- `.env` 파일 제외 확인
- Cloudtype 자동 배포 설정

### 4. Cloudtype 시크릿 설정
- YAML 파일 대신 시크릿 사용 권장
- 민감한 정보 보호

### 5. 배포 테스트
- Cloudtype에 배포 후 정상 작동 확인
- `/1_giup/routes/load` 엔드포인트 테스트
- 데이터 업로드 기능 테스트

---

## 19. 참고 자료

### 공식 문서
- [Cloudtype 공식 문서](https://docs.cloudtype.io/)
- [PostgreSQL 공식 문서](https://www.postgresql.org/docs/)
- [Flask 공식 문서](https://flask.palletsprojects.com/)

### 관련 파일 위치
- 환경 설정: `module/db_config.py`
- 메인 앱: `main_app.py`
- 데이터 업로드: `1_giup/routes/load.py`
- 배포 가이드: `Cloudtype_배포_가이드.md`

### 중요 URL
- Cloudtype 대시보드: https://cloudtype.io/
- GitHub 저장소: https://github.com/gbdata365/my_flask_app

---

## 20. 작업 완료 항목

✅ PostgreSQL 연결 오류 해결
✅ 환경 자동 감지 시스템 구현
✅ `.env` 파일 구성 완료
✅ `load.py` 파일 이동 및 웹 인터페이스 추가
✅ 동적 라우팅 시스템 통합
✅ Windows 콘솔 인코딩 문제 해결
✅ Cloudtype 배포 설정 (YAML 파일)
✅ 시크릿 관리 방법 안내
✅ 여러 서비스 운영 가이드 작성
✅ PostgreSQL 사용자 계정 관리 방법 안내
✅ DBeaver 연결 설정 안내
✅ 외부 접속 문제 진단
✅ SECRET_KEY 이름 변경
✅ 종합 배포 가이드 문서 작성

---

## 21. 미완료 항목 (사용자 작업 필요)

⚠️ Cloudtype PostgreSQL 외부 접속 활성화
⚠️ DBeaver 연결 성공
⚠️ GitHub에 코드 푸시
⚠️ Cloudtype에 배포 및 테스트
⚠️ 일반 사용자 계정 생성 (선택 사항)

---

**작성일:** 2025년 10월 2일
**작성자:** Claude Code
**버전:** 1.0

---

## 부록: 주요 환경 변수 정리

### 필수 환경 변수

| 변수명 | 용도 | 로컬 값 | Cloudtype 값 |
|--------|------|---------|--------------|
| POSTGRES_HOST | DB 호스트 | (자동 선택) | (자동 선택) |
| POSTGRES_HOST_EXTERNAL | 외부 접속 호스트 | svc.sel3.cloudtype.app | (불필요) |
| POSTGRES_PORT_EXTERNAL | 외부 접속 포트 | 32596 | (불필요) |
| POSTGRES_DB | DB 이름 | postgres | postgres |
| POSTGRES_USER | DB 사용자 | gbdo | gbdo |
| POSTGRES_PASSWORD | DB 비밀번호 | rudqnrehc-jd11 | rudqnrehc-jd11 |
| DATABASE_URL | 전체 연결 문자열 | postgresql://... | postgresql://... |
| FLASK_ENV | Flask 환경 | production | production |
| SECRET_KEY | Flask 세션 키 | csv_dashboard... | csv_dashboard... |
| SERVER_HOST | 서버 바인딩 | 0.0.0.0 | 0.0.0.0 |
| SERVER_PORT | 서버 포트 | 5000 | 5000 |
| LOG_LEVEL | 로그 레벨 | INFO | INFO |

---

## 부록: 시스템 아키텍처 다이어그램

```
┌─────────────────────────────────────────────┐
│           Cloudtype 클라우드 환경             │
│                                             │
│  ┌──────────────────────────────────┐      │
│  │   Flask Application              │      │
│  │   - main_app.py                  │      │
│  │   - 1_giup/routes/load.py        │      │
│  │   - module/db_config.py          │      │
│  └───────────┬──────────────────────┘      │
│              │                              │
│              │ postgresql:5432              │
│              │ (내부 네트워크)               │
│              ↓                              │
│  ┌──────────────────────────────────┐      │
│  │   PostgreSQL Database            │      │
│  │   - postgres DB                  │      │
│  │   - User: gbdo                   │      │
│  └──────────────────────────────────┘      │
│              │                              │
│              │ 외부 엔드포인트                │
│              │ svc.sel3.cloudtype.app:32596 │
│              │ (현재 비활성화)                │
└──────────────┼──────────────────────────────┘
               │
               │ (외부 접속 활성화 필요)
               ↓
┌─────────────────────────────────────────────┐
│           로컬 개발 환경                      │
│                                             │
│  ┌──────────────────────────────────┐      │
│  │   Flask Application (Local)      │      │
│  │   - python main_app.py           │      │
│  │   - .env 파일 사용                 │      │
│  │   - 환경 자동 감지                 │      │
│  └───────────┬──────────────────────┘      │
│              │                              │
│              └─── 외부 접속 시도 ────┐       │
│                                      │       │
│  ┌──────────────────────────────────┐      │
│  │   DBeaver                        │      │
│  │   - 데이터베이스 관리 도구          │      │
│  └───────────┬──────────────────────┘      │
│              │                              │
│              └─── 외부 접속 시도 ────┘       │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 최종 정리

이번 작업을 통해:
1. ✅ 로컬과 클라우드 환경을 자동으로 구분하는 시스템 구축
2. ✅ `.env` 파일을 GitHub에서 안전하게 제외
3. ✅ Cloudtype 배포를 위한 YAML 설정 완료
4. ✅ 데이터 업로드 기능을 웹 인터페이스로 구현
5. ✅ 종합 배포 가이드 문서 작성

남은 작업:
1. ⚠️ Cloudtype PostgreSQL 외부 접속 활성화 (DBeaver 연결용)
2. ⚠️ GitHub 푸시 및 Cloudtype 배포
3. ⚠️ 배포 후 정상 작동 테스트

**성공적인 배포를 위해 `Cloudtype_배포_가이드.md`를 참고하세요!**
